name: E2E Repository PR CI

on:
  pull_request:
    branches: [main]
    paths:
      - 'tests/**'
      - 'playwright.config.ts'
      - 'package.json'
      - 'docker-compose.e2e.yml'
      - '.github/workflows/**'

permissions:
  contents: read
  actions: read
  pull-requests: write
  issues: write
  checks: write
  repository-projects: read
  metadata: read
  packages: read

jobs:
  validate-e2e-tests:
    runs-on: ubuntu-latest
    outputs:
      environment_status: ${{ steps.environment-check.outputs.status }}
      test_results: ${{ steps.test-execution.outputs.results }}
      error_source: ${{ steps.error-analysis.outputs.source }}
    steps:
      - name: Checkout E2E Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Checkout Frontend Repository
        uses: actions/checkout@v4
        with:
          repository: satoshi-watanabe-0001/ahamo-dummy-demo2-frontend-workspace
          ref: main
          path: repos/ahamo-dummy-demo2-frontend-workspace
          persist-credentials: true

      - name: Checkout API Gateway Repository
        uses: actions/checkout@v4
        with:
          repository: satoshi-watanabe-0001/ahamo-dummy-demo2-api-gateway-service
          ref: main
          path: repos/ahamo-dummy-demo2-api-gateway-service
          persist-credentials: true

      - name: Checkout Auth Service Repository
        uses: actions/checkout@v4
        with:
          repository: satoshi-watanabe-0001/-satoshi-watanabe-0001-ahamo-dummy-demo2-auth-service
          ref: main
          path: repos/-satoshi-watanabe-0001-ahamo-dummy-demo2-auth-service
          persist-credentials: true

      - name: Install Browser Dependencies
        run: |
          sudo apt-get update
          sudo apt-get install -y \
            libgles2-mesa-dev \
            libgstreamer1.0-dev \
            libgstreamer-plugins-base1.0-dev \
            libgstreamer-plugins-bad1.0-dev \
            libgstreamer-plugins-good1.0-dev

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'

      - name: Install Dependencies
        run: |
          npm install
          npx playwright install
          sudo npx playwright install-deps

      - name: Lint Test Files
        run: |
          echo "=== E2Eãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯ ==="
          npx tsc --noEmit --project tsconfig.json
          echo "âœ… TypeScriptæ§‹æ–‡ãƒã‚§ãƒƒã‚¯å®Œäº†"

      - name: Check Required Dockerfiles
        id: check-dockerfiles
        run: |
          echo "=== Dockerfileã®å­˜åœ¨ç¢ºèª ==="
          
          missing_dockerfiles=()
          
          if [ ! -f "repos/ahamo-dummy-demo2-frontend-workspace/Dockerfile.e2e" ]; then
            echo "âŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Dockerfile.e2eãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            missing_dockerfiles+=("frontend")
          else
            echo "âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®Dockerfile.e2eãŒå­˜åœ¨ã—ã¾ã™"
          fi
          
          if [ ! -f "repos/ahamo-dummy-demo2-api-gateway-service/Dockerfile" ]; then
            echo "âŒ API Gatewayã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            missing_dockerfiles+=("api-gateway")
          else
            echo "âœ… API Gatewayã®DockerfileãŒå­˜åœ¨ã—ã¾ã™"
          fi
          
          if [ ! -f "repos/-satoshi-watanabe-0001-ahamo-dummy-demo2-auth-service/Dockerfile" ]; then
            echo "âŒ èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            missing_dockerfiles+=("auth-service")
          else
            echo "âœ… èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã®DockerfileãŒå­˜åœ¨ã—ã¾ã™"
          fi
          
          if [ ! -f "repos/ahamo-dummy-demo2-product-service/Dockerfile" ]; then
            echo "âŒ å•†å“ã‚µãƒ¼ãƒ“ã‚¹ã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            missing_dockerfiles+=("product-service")
          else
            echo "âœ… å•†å“ã‚µãƒ¼ãƒ“ã‚¹ã®DockerfileãŒå­˜åœ¨ã—ã¾ã™"
          fi
          
          if [ ${#missing_dockerfiles[@]} -gt 0 ]; then
            echo "missing_dockerfiles=${missing_dockerfiles[*]}" >> $GITHUB_OUTPUT
            echo "status=missing" >> $GITHUB_OUTPUT
            
            echo "âŒ ä»¥ä¸‹ã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“:"
            for service in "${missing_dockerfiles[@]}"; do
              echo "  - $service"
            done
            
            if [[ " ${missing_dockerfiles[*]} " =~ " auth-service " ]] || [[ " ${missing_dockerfiles[*]} " =~ " product-service " ]] || [[ " ${missing_dockerfiles[*]} " =~ " api-gateway " ]]; then
              echo "error_source=backend" >> $GITHUB_OUTPUT
              echo "âŒ ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®å•é¡Œ: DockerfileãŒæ¬ è½ã—ã¦ã„ã¾ã™"
            elif [[ " ${missing_dockerfiles[*]} " =~ " frontend " ]]; then
              echo "error_source=frontend" >> $GITHUB_OUTPUT
              echo "âŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®å•é¡Œ: DockerfileãŒæ¬ è½ã—ã¦ã„ã¾ã™"
            fi
          else
            echo "status=ok" >> $GITHUB_OUTPUT
            echo "âœ… ã™ã¹ã¦ã®DockerfileãŒå­˜åœ¨ã—ã¾ã™"
          fi

      - name: Start E2E Environment
        id: environment-setup
        if: steps.check-dockerfiles.outputs.status == 'ok'
        run: |
          echo "=== E2Eç’°å¢ƒèµ·å‹•é–‹å§‹ ==="
          
          if docker-compose -f docker-compose.e2e.yml build; then
            echo "âœ… Docker buildæˆåŠŸ"
            build_status="success"
          else
            echo "âŒ Docker buildå¤±æ•—"
            build_status="failed"
            echo "build_status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          if docker-compose -f docker-compose.e2e.yml up -d; then
            echo "âœ… Docker compose upæˆåŠŸ"
            compose_status="success"
          else
            echo "âŒ Docker compose upå¤±æ•—"
            compose_status="failed"
            echo "compose_status=failed" >> $GITHUB_OUTPUT
            exit 1
          fi
          
          echo "=== ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•å¾…æ©Ÿï¼ˆ60ç§’ï¼‰ ==="
          sleep 60

      - name: Environment Health Check
        id: environment-check
        run: |
          echo "=== ã‚µãƒ¼ãƒ“ã‚¹ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯é–‹å§‹ ==="
          
          frontend_status="unknown"
          api_gateway_status="unknown"
          auth_status="unknown"
          
          if curl -f -s http://localhost:3000/health > /dev/null 2>&1; then
            echo "âœ… ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰æ­£å¸¸ (http://localhost:3000)"
            frontend_status="ok"
          else
            echo "âŒ ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç•°å¸¸ (http://localhost:3000)"
            frontend_status="error"
            echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ­ã‚°:"
            docker-compose -f docker-compose.e2e.yml logs frontend || true
          fi
          
          if curl -f -s http://localhost:3001/ > /dev/null 2>&1; then
            echo "âœ… API Gatewayæ­£å¸¸ (http://localhost:3001)"
            api_gateway_status="ok"
          else
            echo "âŒ API Gatewayç•°å¸¸ (http://localhost:3001)"
            api_gateway_status="error"
            echo "API Gatewayãƒ­ã‚°:"
            docker-compose -f docker-compose.e2e.yml logs api-gateway || true
          fi
          
          if curl -f -s http://localhost:8080/api/v1/actuator/health > /dev/null 2>&1; then
            echo "âœ… èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸ (http://localhost:8080)"
            auth_status="ok"
          else
            echo "âŒ èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ç•°å¸¸ (http://localhost:8080)"
            auth_status="error"
            echo "èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ãƒ­ã‚°:"
            docker-compose -f docker-compose.e2e.yml logs auth-service || true
          fi
          
          if [[ "$frontend_status" == "ok" && "$api_gateway_status" == "ok" && "$auth_status" == "ok" ]]; then
            echo "status=healthy" >> $GITHUB_OUTPUT
            echo "âœ… å…¨ã‚µãƒ¼ãƒ“ã‚¹æ­£å¸¸ - E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œå¯èƒ½"
          else
            echo "status=unhealthy" >> $GITHUB_OUTPUT
            echo "âŒ ã‚µãƒ¼ãƒ“ã‚¹ç•°å¸¸æ¤œå‡º:"
            echo "  - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰: $frontend_status"
            echo "  - API Gateway: $api_gateway_status"
            echo "  - èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹: $auth_status"
          fi
          
          echo "frontend_status=$frontend_status" >> $GITHUB_OUTPUT
          echo "api_gateway_status=$api_gateway_status" >> $GITHUB_OUTPUT
          echo "auth_status=$auth_status" >> $GITHUB_OUTPUT

      - name: Execute E2E Tests
        id: test-execution
        if: steps.environment-check.outputs.status == 'healthy'
        run: |
          echo "=== E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œé–‹å§‹ ==="
          
          test_exit_code=0
          
          changed_files=$(git diff --name-only origin/main...HEAD | grep "tests/playwright" | grep "\.spec\.ts$" || true)
          
          if [ -n "$changed_files" ]; then
            echo "å¤‰æ›´ã•ã‚ŒãŸãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«:"
            echo "$changed_files"
            
            for test_file in $changed_files; do
              if [ -f "$test_file" ]; then
                echo "=== å®Ÿè¡Œä¸­: $test_file ==="
                if npx playwright test "$test_file" --reporter=json,html; then
                  echo "âœ… $test_file - æˆåŠŸ"
                else
                  echo "âŒ $test_file - å¤±æ•—"
                  test_exit_code=1
                fi
              fi
            done
          else
            echo "=== å…¨E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œ ==="
            if npx playwright test --reporter=json,html; then
              echo "âœ… å…¨ãƒ†ã‚¹ãƒˆæˆåŠŸ"
            else
              echo "âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—"
              test_exit_code=1
            fi
          fi
          
          if [ -f "test-results/.last-run.json" ]; then
            total_tests=$(jq -r '.stats.total' test-results/.last-run.json 2>/dev/null || echo "0")
            passed_tests=$(jq -r '.stats.passed' test-results/.last-run.json 2>/dev/null || echo "0")
            failed_tests=$(jq -r '.stats.failed' test-results/.last-run.json 2>/dev/null || echo "0")
            
            if [ "$total_tests" -gt 0 ]; then
              success_rate=$(echo "scale=2; $passed_tests * 100 / $total_tests" | bc)
            else
              success_rate="0"
            fi
          else
            total_tests="0"
            passed_tests="0"
            failed_tests="0"
            success_rate="0"
          fi
          
          echo "results={\"total\":$total_tests,\"passed\":$passed_tests,\"failed\":$failed_tests,\"success_rate\":\"$success_rate\",\"exit_code\":$test_exit_code}" >> $GITHUB_OUTPUT
          
          exit $test_exit_code

      - name: Error Source Analysis
        id: error-analysis
        if: failure()
        run: |
          echo "=== ã‚¨ãƒ©ãƒ¼åŸå› åˆ†æ ==="
          
          error_source="unknown"
          
          if [[ "${{ steps.check-dockerfiles.outputs.status }}" == "missing" ]]; then
            error_source="${{ steps.check-dockerfiles.outputs.error_source }}"
            
            if [[ "$error_source" == "backend" ]]; then
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª"
              echo "ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
              echo "æ¬ è½ã—ã¦ã„ã‚‹Dockerfile: ${{ steps.check-dockerfiles.outputs.missing_dockerfiles }}"
            elif [[ "$error_source" == "frontend" ]]; then
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª"
              echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã®DockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"
            fi
          else
            frontend_status="${{ steps.environment-check.outputs.frontend_status }}"
            api_gateway_status="${{ steps.environment-check.outputs.api_gateway_status }}"
            auth_status="${{ steps.environment-check.outputs.auth_status }}"
            
            if [[ "$frontend_status" == "error" ]]; then
              error_source="frontend"
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª"
              echo "ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
            elif [[ "$api_gateway_status" == "error" ]]; then
              error_source="backend"
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªï¼ˆAPI Gatewayï¼‰"
              echo "API Gatewayã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
            elif [[ "$auth_status" == "error" ]]; then
              error_source="backend"
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªï¼ˆèªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ï¼‰"
              echo "èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ã¾ã›ã‚“"
            else
              error_source="e2e"
              echo "ğŸ” ã‚¨ãƒ©ãƒ¼åŸå› : E2Eãƒ†ã‚¹ãƒˆãƒªãƒã‚¸ãƒˆãƒª"
              echo "ã‚µãƒ¼ãƒ“ã‚¹ã¯æ­£å¸¸ã§ã™ãŒã€E2Eãƒ†ã‚¹ãƒˆã«å•é¡ŒãŒã‚ã‚Šã¾ã™"
            fi
          fi
          
          echo "source=$error_source" >> $GITHUB_OUTPUT

      - name: Upload Test Results
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: e2e-test-results
          path: |
            test-results/
            playwright-report/
            *.json

      - name: Cleanup Environment
        if: always()
        run: |
          echo "=== ç’°å¢ƒã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ— ==="
          docker-compose -f docker-compose.e2e.yml down -v || true
          docker system prune -f || true

  report-results:
    needs: validate-e2e-tests
    runs-on: ubuntu-latest
    if: always()
    steps:
      - name: Generate Test Report Comment
        uses: actions/github-script@v7
        with:
          script: |
            const environmentStatus = '${{ needs.validate-e2e-tests.outputs.environment_status }}';
            const testResults = '${{ needs.validate-e2e-tests.outputs.test_results }}';
            const errorSource = '${{ needs.validate-e2e-tests.outputs.error_source }}';
            const jobResult = '${{ needs.validate-e2e-tests.result }}';
            
            let comment = `## ğŸ§ª E2Eãƒ†ã‚¹ãƒˆå®Ÿè¡Œçµæœ\n\n`;
            comment += `**å®Ÿè¡Œæ—¥æ™‚**: ${new Date().toLocaleString('ja-JP', { timeZone: 'Asia/Tokyo' })}\n`;
            comment += `**ãƒ–ãƒ©ãƒ³ãƒ**: \`${context.payload.pull_request.head.ref}\`\n`;
            comment += `**ã‚³ãƒŸãƒƒãƒˆ**: \`${context.payload.pull_request.head.sha.substring(0, 7)}\`\n\n`;
            
            if (jobResult === 'success') {
              comment += `### âœ… ãƒ†ã‚¹ãƒˆæˆåŠŸ\n\n`;
              
              if (testResults && testResults !== 'null') {
                try {
                  const results = JSON.parse(testResults);
                  comment += `**ãƒ†ã‚¹ãƒˆçµæœ**:\n`;
                  comment += `- ç·ãƒ†ã‚¹ãƒˆæ•°: ${results.total}\n`;
                  comment += `- æˆåŠŸ: ${results.passed}\n`;
                  comment += `- å¤±æ•—: ${results.failed}\n`;
                  comment += `- æˆåŠŸç‡: ${results.success_rate}%\n\n`;
                } catch (e) {
                  comment += `ãƒ†ã‚¹ãƒˆçµæœã®è©³ç´°ã¯[Actionsã‚¿ãƒ–](${context.payload.repository.html_url}/actions/runs/${context.runId})ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\n\n`;
                }
              }
              
              comment += `ã™ã¹ã¦ã®E2Eãƒ†ã‚¹ãƒˆãŒæ­£å¸¸ã«å®Ÿè¡Œã•ã‚Œã¾ã—ãŸã€‚\n`;
            } else {
              comment += `### âŒ ãƒ†ã‚¹ãƒˆå¤±æ•—\n\n`;
              
              if (errorSource === 'frontend') {
                comment += `**ç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ç•°å¸¸\n`;
                comment += `ğŸ” **ã‚¨ãƒ©ãƒ¼åŸå› **: ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª\n`;
                comment += `ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ãªã„ã‹ã€å¿…è¦ãªDockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\n`;
                comment += `ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚\n\n`;
              } else if (errorSource === 'backend') {
                comment += `**ç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ç•°å¸¸\n`;
                comment += `ğŸ” **ã‚¨ãƒ©ãƒ¼åŸå› **: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒª\n`;
                comment += `ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAPI Gatewayã€èªè¨¼ã‚µãƒ¼ãƒ“ã‚¹ã€ã¾ãŸã¯å•†å“ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ãŒæ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ãªã„ã‹ã€å¿…è¦ãªDockerfileãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚\n`;
                comment += `ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚\n\n`;
              } else if (environmentStatus === 'unhealthy') {
                comment += `**ç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: ç•°å¸¸\n`;
                comment += `ğŸ” **ã‚¨ãƒ©ãƒ¼åŸå› **: E2Eãƒ†ã‚¹ãƒˆãƒªãƒã‚¸ãƒˆãƒª\n`;
                comment += `E2Eãƒ†ã‚¹ãƒˆã¾ãŸã¯ç’°å¢ƒè¨­å®šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚\n\n`;
              } else {
                comment += `**ç’°å¢ƒã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æ­£å¸¸\n`;
                comment += `ğŸ” **ã‚¨ãƒ©ãƒ¼åŸå› **: E2Eãƒ†ã‚¹ãƒˆãƒªãƒã‚¸ãƒˆãƒª\n`;
                comment += `ã‚µãƒ¼ãƒ“ã‚¹ã¯æ­£å¸¸ã«èµ·å‹•ã—ã¦ã„ã¾ã™ãŒã€E2Eãƒ†ã‚¹ãƒˆã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚\n\n`;
              }
              
              comment += `è©³ç´°ãªã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã¯[Actionsã‚¿ãƒ–](${context.payload.repository.html_url}/actions/runs/${context.runId})ã‚’ã”ç¢ºèªãã ã•ã„ã€‚\n`;
            }
            
            comment += `\n---\n`;
            comment += `ğŸ’¡ **æ³¨æ„**: ã‚¨ãƒ©ãƒ¼åŸå› ãŒãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ãƒ»ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ãƒªãƒã‚¸ãƒˆãƒªã«ã‚ã‚‹å ´åˆã¯ã€è©²å½“ãƒªãƒã‚¸ãƒˆãƒªã§ã®ä¿®æ­£ãŒå¿…è¦ã§ã™ã€‚\n`;
            
            github.rest.issues.createComment({
              issue_number: context.issue.number,
              owner: context.repo.owner,
              repo: context.repo.repo,
              body: comment
            });
